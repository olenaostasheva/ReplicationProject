---
title: "The 52-weeek High and Momentum Investing: A Partial Replication of George and Hwang (2004)"
author: "Wenhao Yu and Olena Ostasheva"
date: "`May 24th, 2016`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Vignette Title}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(ws.data)
library(lubridate)
library(dplyr)
library(tibble)
library(tidyr)
library(ggplot2)
library(RcppRoll)
data(secref)
data(yearly)
```


#Introduction and Literature Overview

        Considerable research has been conducted to discover predictable patterns in stock behavior.  In contrast with the random walk hypothesis, results generated by Jegadeesh and Titman (1993), Moskowitz and Grinblatt (1999), and George and Hwang (2004) demonstrate that stock returns exhibit momentum behaviors.  Jegadeesh and Titman (1993) developed a strategy for individual stocks based on past returns.  In contrast, Moskowitz and Grinblatt (1999) argued that stock returns are more likely driven by industry momentum than individual stock momentum alone.  George and Hwang (2004) conducted a head to head comparison of the two previous methods, as well as a third strategy based on the relative nearness to a stock’s 52-week high prices.  Their results show that nearness to the 52 week high is a better predictor than past returns.
        Jegadeesh and Titman (1993)’s methodology measures the past 6 months return performance of individual stocks and develops a long portfolio of the 30% percent stocks with the highest return and a short portfolio on the bottom 30% of stocks.  This strategy results in significantly profitable returns, but the authors also determine that the profitability is not due to either systematic risk or to delayed stock price reactions.  These results present a challenge to the view that markets are semistrong-form efficient, that implies that all public information is incorporated into a stock's current share price.
        The second strategy that GH replicate follows similar style of momentum investing but focuses on industries.  Moskowitz and Grinblatt (1999) form a portfolio that takes a long position in 30% of top performing industries and shorts the bottom 30%, with results showing greater profitability compared to individual stock selection.  The results support industries as a significant source of momentum.
        A third method by George and Hwang (2004) is based on relative distance from a stock’s 52 week high price. The ranking of stocks is based on the ratio between a stock’s current prices to its 52 week high price, with portfolio that goes long (short) the highest (lowest) 30% of these ratios.  The rationale for this model is that when stock’s price is near its 52-week high, traders are more reluctant to bid higher despite positive news. The price levels will eventually adjust, but the period of reluctance creates an opportunity for predictability in stock pricing.   Additionally, many economic studies on this phenomenon, such as the “adjustment and anchoring bias” surveyed in Kahneman, Slovic, and Tversky (1982) suggest that traders use 52-week high prices as an “anchor” to which prices will move proportionally.  A comparison conducted in this study shows that although returns are similar in numbers, a large part of individual stock momentum is attributable to stocks with prices either very near or far from the 52-week high.  This explanation indicates a significant influence in the 52-week ratios to the pricing and profitability of individual stocks.


#Data and Method 
Our data consists of the daily statistics for 3060 securities that traded on the NYSE between 1999-01-02 and 2007-12-31. For the initial data set we filter out the top 1,500 largest cap US stocks. We also remove all the rows for which stocks had returns less than or equal to 200% over the consecutive days. This is done in order to escape any unintentional errors. In total we remove 346 rows that is a very small percentage of the 5 mln rows we have in the initial data set.         

Once we have filtered the data, we find the mean past 6 months returns, mean future 6 months returns and 52 week high for each stock for each day. Additionally, for the MG strategy we find the mean past and future 6 months returns for each industry. Therefore our first portfolio is not formed until !!!! when the data becomes available. We omit all the rows with NAs for the days when data is not available. 

Let's first take a look at our core data. As the table shows it contains information on the industry that the stock belongs to, price and daily returns as well as on the past and future 6 months returns.   
```{r setup, include=FALSE}
x <- gather_data(symbols=secref$symbol,1998:2007)
head(x)
summary(x)
```

#Replication
We first replicate results for the JT and MG startegies and then compare the results of those strategies to the GH strategy. 
In the JT srategy, we use the past 6 months returns of individual stocks to build a portfolio of Winners and Losers. Winners are the top 30% stocks with the highest return, Losers form the bottom 30% of stocks with the lowest return. 

```{r setup, include=FALSE}
#REPLICATING JT STRATEGY 

#Find daily returns for 
daily_returns_JT <- JT_rank(x)

monthly_returns_JT <- gather_monthly(daily_returns_JT)

#Find mean returns for each month for Winners and for Losers
#Get rid of all the rows for which we do not have data (=NA). In particular, we have many NAs rows for ret.6.0.m in 
#the begining because the data was not available for the prior 6 months.
#Make sure to group by month and ret.class because we are finding the mean return for each class for each month. 

portfolio_returns_JT <- monthly_returns_JT %>%
                        na.omit() %>%
                        group_by(month, ret.class) %>%
                        summarize(mean_return=mean(ret.0.6.m)) %>%
                        spread(key=ret.class,value=mean_return) %>%
                        mutate(diff=Winners_JT-Losers_JT) %>%
                        select(month, Winners_JT, Losers_JT, diff)

#Find monthly average portfolio returns for Winner and Loser portfolios 
mean(portfolio_returns_JT$Winners_JT)/6
mean(portfolio_returns_JT$Losers_JT)/6
mean(portfolio_returns_JT$diff)/6
```

Second, let's replicate MG strategy. 
In order to build portfolio according to MG strategy we first find the mean industry returns for the 

```{r setup, include=FALSE}
#REPLICATING MG STRATEGY

daily_returns_MG<-MG_rank(x)
summary(daily_returns_MG)

monthly_returns_MG<-gather_monthly(daily_returns_MG)
summary(monthly_returns_MG)
View(monthly_returns_MG)

portfolio_returns_MG<-monthly_returns_MG %>%
                      na.omit() %>%
                      group_by(month, ind.class) %>%
                      summarize(mean_return=mean(ret.0.6.m)) %>%
                      spread(key=ind.class, value=mean_return) %>%
                      mutate(diff=Winners_MG-Losers_MG) %>%
                      select(month, Winners_MG, Losers_MG,diff)

#Find monthly average portfolio returns for Winner and Loser portfolios 
mean(portfolio_returns_MG$Winners_MG)/6
mean(portfolio_returns_MG$Losers_MG)/6
mean(portfolio_returns_MG$diff)/6

```

Finally, in order to replicate the GH strategy, we first find the 52 week high ratio by dividing current price of the stock by its 52 week high price. The maximim ratio we get is 1 (no current price is higher than a 52 week high, otherwise that would be a 52 week high) and the minimum ratio is !!!!! We then rank the stocks according to the ratios, the top 30% of stocks with the highest ratio form a winner portfolio and bottom 30% of stocks with lowest return form a loser portfolio.   

```{r setup, include=FALSE}
#REPLICATING GH STRATEGY 

ratio_daily_GH <- GH_ratio(x)

daily_ranks_GH <- GH_rank(ratio_daily_GH)

monthly_returns_GH <- gather_monthly(daily_ranks_GH)

portfolio_returns_GH <- monthly_returns_GH %>%
                        na.omit() %>%
                        group_by(month,wh.52.class) %>%
                        summarize(mean_return=mean(ret.0.6.m)) %>%
                        spread(key=wh.52.class,value=mean_return) %>%
                        mutate(diff=Winners_GH-Losers_GH) %>%
                        select(month, Winners_GH, Losers_GH, diff)

#Find monthly average portfolio returns for Winner and Loser portfolios 
mean(portfolio_returns_GH$Winners_GH)/6
mean(portfolio_returns_GH$Losers_GH)/6
mean(portfolio_returns_GH$diff)/6

```

#Results discussion

Chart all the results  
```{r setup, include=FALSE}

#JT strategy
#Relationship between past 6 months returns and future 6 months returns of individual stocks 
monthly_returns_JT %>% ggplot(aes(x=ret.6.0.m, ret.0.6.m))+geom_point()+geom_smooth()+scale_y_continuous(limits = c(-0.5,10))+scale_x_continuous(limits = c(-0.5,11))

#MG returns
#Relationship between the past industry returns and future industry returns 
monthly_returns_MG %>% ggplot(aes(x=ind_ret_past,ind_ret_fut))+geom_point()+geom_smooth()+scale_y_continuous(limits = c(-0.5,2.5))+scale_x_continuous(limits = c(-0.5,3))

#GH returns 
#Relationship between 52 week high ratio and the 6 months future returns 
monthly_returns_GH %>% ggplot(aes(x=wh_52_ratio, ret.0.6.m))+geom_point()+geom_smooth()+scale_y_continuous(limits = c(-0.5,10))
```

Only include January returns to explore the "January effect"
```{r setup, include=FALSE}
#Include only the month of January in the data 
#Run through the strtategies again using January data only 

#JT strategy - January only
daily_returns_JT <- JT_rank(x)

monthly_returns_JT <- gather_monthly(daily_returns_JT)
monthly_returns_JT <- monthly_returns_JT %>% filter(format.Date(date, "%m")=="01")

portfolio_returns_JT <- monthly_returns_JT %>%
                        na.omit() %>%
                        group_by(month, ret.class) %>%
                        summarize(mean_return=mean(ret.0.6.m)) %>%
                        spread(key=ret.class,value=mean_return) %>%
                        mutate(diff=Winners_JT-Losers_JT) %>%
                        select(month, Winners_JT, Losers_JT, diff)

#Find monthly average portfolio returns for Winner and Loser portfolios 
mean(portfolio_returns_JT$Winners_JT)/6
mean(portfolio_returns_JT$Losers_JT)/6
mean(portfolio_returns_JT$diff)/6


#MG strategy - January only
daily_returns_MG <- MG_rank(x)

monthly_returns_MG <- gather_monthly(daily_returns_MG)
monthly_returns_MG <- monthly_returns_MG %>% filter(format.Date(date, "%m")=="01")

portfolio_returns_MG<-monthly_returns_MG %>%
                      na.omit() %>%
                      group_by(month, ind.class) %>%
                      summarize(mean_return=mean(ret.0.6.m)) %>%
                      spread(key=ind.class, value=mean_return) %>%
                      mutate(diff=Winners_MG-Losers_MG) %>%
                      select(month, Winners_MG, Losers_MG,diff)

#Find monthly average portfolio returns for Winner and Loser portfolios 
mean(portfolio_returns_MG$Winners_MG)/6
mean(portfolio_returns_MG$Losers_MG)/6
mean(portfolio_returns_MG$diff)/6


#GH strategy - January only
ratio_daily_GH <- GH_ratio(x)

daily_ranks_GH <- GH_rank(ratio_daily_GH)

monthly_returns_GH <- gather_monthly(daily_ranks_GH)
monthly_returns_GH <- monthly_returns_GH %>% filter(format.Date(date, "%m")=="01")
        
portfolio_returns_GH <- monthly_returns_GH %>%
                        na.omit() %>%
                        group_by(month,wh.52.class) %>%
                        summarize(mean_return=mean(ret.0.6.m)) %>%
                        spread(key=wh.52.class,value=mean_return) %>%
                        mutate(diff=Winners_GH-Losers_GH) %>%
                        select(month, Winners_GH, Losers_GH, diff)

#Find monthly average portfolio returns for Winner and Loser portfolios 
mean(portfolio_returns_GH$Winners_GH)/6
mean(portfolio_returns_GH$Losers_GH)/6
mean(portfolio_returns_GH$diff)/6

```


Exclude January returns to explore the "January effect"
```{r setup, include=FALSE}

#JT - exlude data for the month of January 

daily_returns_JT <- JT_rank(x)

monthly_returns_JT <- gather_monthly(daily_returns_JT)

exclude_Jan_JT <- filter(monthly_returns_JT, month!="Jan-1998" & month!="Jan-1999" & month!="Jan-2000" & month!="Jan-2001" & month!="Jan-2002" & month!="Jan-2003"& month!="Jan-2004"& month!="Jan-2005" & month!="Jan-2006" & month!="Jan-2007")
View(exclude_Jan_JT)

#Find mean returns for each month for Winners and for Losers
#Get rid of all the rows for which we do not have data (=NA). In particular, we have many NAs rows for ret.6.0.m in 
#the begining because the data was not available for the prior 6 months.
#Make sure to group by month and ret.class because we are finding the mean return for each class for each month. 

portfolio_returns_JT <- exclude_Jan_JT %>%
                        na.omit() %>%
                        group_by(month, ret.class) %>%
                        summarize(mean_return=mean(ret.0.6.m)) %>%
                        spread(key=ret.class,value=mean_return) %>%
                        mutate(diff=Winners_JT-Losers_JT) %>%
                        select(month, Winners_JT, Losers_JT, diff)

#Find monthly average portfolio returns for Winner and Loser portfolios 
mean(portfolio_returns_JT$Winners_JT)/6
mean(portfolio_returns_JT$Losers_JT)/6
mean(portfolio_returns_JT$diff)/6

#MG - exlude data for the month of January 
daily_returns_MG <- MG_rank(x)

monthly_returns_MG <- gather_monthly(daily_returns_MG)

exclude_Jan_MG <- filter(monthly_returns_MG, month!="Jan-1998" & month!="Jan-1999" & month!="Jan-2000" & month!="Jan-2001" & month!="Jan-2002" & month!="Jan-2003"& month!="Jan-2004"& month!="Jan-2005" & month!="Jan-2006" & month!="Jan-2007")
View(exclude_Jan)

portfolio_returns_MG <- exclude_Jan %>%
                        na.omit() %>%
                        group_by(month, ind.class) %>%
                        summarize(mean_return=mean(ret.0.6.m)) %>%
                        spread(key=ind.class, value=mean_return) %>%
                        mutate(diff=Winners_MG-Losers_MG) %>%
                        select(month, Winners_MG, Losers_MG,diff)

#Find monthly average portfolio returns for Winner and Loser portfolios 
mean(portfolio_returns_MG$Winners_MG)/6
mean(portfolio_returns_MG$Losers_MG)/6
mean(portfolio_returns_MG$diff)/6


#GH - exlude data for the month of January
ratio_daily_GH <- GH_ratio(x)

daily_ranks_GH <- GH_rank(ratio_daily_GH)

monthly_returns_GH <- gather_monthly(daily_ranks_GH)

exclude_Jan_GH <- filter(monthly_returns_GH, month!="Jan-1998" & month!="Jan-1999" & month!="Jan-2000" & month!="Jan-2001" & month!="Jan-2002" & month!="Jan-2003"& month!="Jan-2004"& month!="Jan-2005" & month!="Jan-2006" & month!="Jan-2007")
View(exclude_Jan)

portfolio_returns_GH <- exclude_Jan_GH %>%
                        na.omit() %>%
                        group_by(month,wh.52.class) %>%
                        summarize(mean_return=mean(ret.0.6.m)) %>%
                        spread(key=wh.52.class,value=mean_return) %>%
                        mutate(diff=Winners_GH-Losers_GH) %>%
                        select(month, Winners_GH, Losers_GH, diff)

#Find monthly average portfolio returns for Winner and Loser portfolios 
mean(portfolio_returns_GH$Winners_GH)/6
mean(portfolio_returns_GH$Losers_GH)/6
mean(portfolio_returns_GH$diff)/6
